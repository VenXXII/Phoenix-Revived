{"version":3,"file":"uv.handler.js","mappings":"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","sources":["webpack://@titaniumnetwork-dev/ultraviolet/./src/uv.handler.js"],"sourcesContent":["/**\r\n * @type {import('./uv').UltravioletCtor}\r\n */\r\nconst Ultraviolet = globalThis.Ultraviolet;\r\n\r\n/**\r\n * @type {import('./uv').UVClientCtor}\r\n */\r\nconst UVClient = globalThis.UVClient;\r\n\r\nif (!self.__uv) {\r\n    __uvHook(self, self.__uv$config, self.__uv$config.bare);\r\n}\r\n\r\nfunction __uvHook(window, config = {}, bare = '/bare/') {\r\n    if ('__uv' in window && window.__uv instanceof Ultraviolet) return false;\r\n\r\n    if (window.document && !!window.window) {\r\n        window.document\r\n            .querySelectorAll('script[__uv-script]')\r\n            .forEach((node) => node.remove());\r\n    }\r\n\r\n    const worker = !window.window;\r\n    const master = '__uv';\r\n    const methodPrefix = '__uv$';\r\n    const __uv = new Ultraviolet(config);\r\n\r\n    if (typeof config.construct === 'function') {\r\n        config.construct(__uv, worker ? 'worker' : 'window');\r\n    }\r\n\r\n    const client = new UVClient(window);\r\n    const {\r\n        HTMLMediaElement,\r\n        HTMLScriptElement,\r\n        HTMLAudioElement,\r\n        HTMLVideoElement,\r\n        HTMLInputElement,\r\n        HTMLEmbedElement,\r\n        HTMLTrackElement,\r\n        HTMLAnchorElement,\r\n        HTMLIFrameElement,\r\n        HTMLAreaElement,\r\n        HTMLLinkElement,\r\n        HTMLBaseElement,\r\n        HTMLFormElement,\r\n        HTMLImageElement,\r\n        HTMLSourceElement,\r\n    } = window;\r\n\r\n    client.nativeMethods.defineProperty(window, '__uv', {\r\n        value: __uv,\r\n        enumerable: false,\r\n    });\r\n\r\n    __uv.meta.origin = location.origin;\r\n    __uv.location = client.location.emulate(\r\n        (href) => {\r\n            if (href === 'about:srcdoc') return new URL(href);\r\n            if (href.startsWith('blob:')) href = href.slice('blob:'.length);\r\n            return new URL(__uv.sourceUrl(href));\r\n        },\r\n        (href) => {\r\n            return __uv.rewriteUrl(href);\r\n        }\r\n    );\r\n\r\n    __uv.bareData = window.__uv$bareData;\r\n    __uv.cookieStr = window.__uv$cookies || '';\r\n    __uv.meta.url = __uv.location;\r\n    __uv.domain = __uv.meta.url.host;\r\n    __uv.blobUrls = new window.Map();\r\n    __uv.referrer = '';\r\n    __uv.cookies = [];\r\n    __uv.localStorageObj = {};\r\n    __uv.sessionStorageObj = {};\r\n\r\n    try {\r\n        __uv.bare = new URL(bare, window.location.href);\r\n    } catch (e) {\r\n        __uv.bare = window.parent.__uv.bare;\r\n    }\r\n\r\n    // websockets\r\n    const bareClient = new Ultraviolet.BareClient(__uv.bare, __uv.bareData);\r\n\r\n    if (__uv.location.href === 'about:srcdoc') {\r\n        __uv.meta = window.parent.__uv.meta;\r\n    }\r\n\r\n    if (window.EventTarget) {\r\n        __uv.addEventListener = window.EventTarget.prototype.addEventListener;\r\n        __uv.removeListener = window.EventTarget.prototype.removeListener;\r\n        __uv.dispatchEvent = window.EventTarget.prototype.dispatchEvent;\r\n    }\r\n\r\n    // Storage wrappers\r\n    client.nativeMethods.defineProperty(\r\n        client.storage.storeProto,\r\n        '__uv$storageObj',\r\n        {\r\n            get() {\r\n                if (this === client.storage.sessionStorage)\r\n                    return __uv.sessionStorageObj;\r\n                if (this === client.storage.localStorage)\r\n                    return __uv.localStorageObj;\r\n            },\r\n            enumerable: false,\r\n        }\r\n    );\r\n\r\n    if (window.localStorage) {\r\n        for (const key in window.localStorage) {\r\n            if (key.startsWith(methodPrefix + __uv.location.origin + '@')) {\r\n                __uv.localStorageObj[\r\n                    key.slice(\r\n                        (methodPrefix + __uv.location.origin + '@').length\r\n                    )\r\n                ] = window.localStorage.getItem(key);\r\n            }\r\n        }\r\n\r\n        __uv.lsWrap = client.storage.emulate(\r\n            client.storage.localStorage,\r\n            __uv.localStorageObj\r\n        );\r\n    }\r\n\r\n    if (window.sessionStorage) {\r\n        for (const key in window.sessionStorage) {\r\n            if (key.startsWith(methodPrefix + __uv.location.origin + '@')) {\r\n                __uv.sessionStorageObj[\r\n                    key.slice(\r\n                        (methodPrefix + __uv.location.origin + '@').length\r\n                    )\r\n                ] = window.sessionStorage.getItem(key);\r\n            }\r\n        }\r\n\r\n        __uv.ssWrap = client.storage.emulate(\r\n            client.storage.sessionStorage,\r\n            __uv.sessionStorageObj\r\n        );\r\n    }\r\n\r\n    let rawBase = window.document\r\n        ? client.node.baseURI.get.call(window.document)\r\n        : window.location.href;\r\n    let base = __uv.sourceUrl(rawBase);\r\n\r\n    client.nativeMethods.defineProperty(__uv.meta, 'base', {\r\n        get() {\r\n            if (!window.document) return __uv.meta.url.href;\r\n\r\n            if (client.node.baseURI.get.call(window.document) !== rawBase) {\r\n                rawBase = client.node.baseURI.get.call(window.document);\r\n                base = __uv.sourceUrl(rawBase);\r\n            }\r\n\r\n            return base;\r\n        },\r\n    });\r\n\r\n    __uv.methods = {\r\n        setSource: methodPrefix + 'setSource',\r\n        source: methodPrefix + 'source',\r\n        location: methodPrefix + 'location',\r\n        function: methodPrefix + 'function',\r\n        string: methodPrefix + 'string',\r\n        eval: methodPrefix + 'eval',\r\n        parent: methodPrefix + 'parent',\r\n        top: methodPrefix + 'top',\r\n    };\r\n\r\n    __uv.filterKeys = [\r\n        master,\r\n        __uv.methods.setSource,\r\n        __uv.methods.source,\r\n        __uv.methods.location,\r\n        __uv.methods.function,\r\n        __uv.methods.string,\r\n        __uv.methods.eval,\r\n        __uv.methods.parent,\r\n        __uv.methods.top,\r\n        methodPrefix + 'protocol',\r\n        methodPrefix + 'storageObj',\r\n        methodPrefix + 'url',\r\n        methodPrefix + 'modifiedStyle',\r\n        methodPrefix + 'config',\r\n        methodPrefix + 'dispatched',\r\n        'Ultraviolet',\r\n        '__uvHook',\r\n    ];\r\n\r\n    client.on('wrap', (target, wrapped) => {\r\n        client.nativeMethods.defineProperty(\r\n            wrapped,\r\n            'name',\r\n            client.nativeMethods.getOwnPropertyDescriptor(target, 'name')\r\n        );\r\n        client.nativeMethods.defineProperty(\r\n            wrapped,\r\n            'length',\r\n            client.nativeMethods.getOwnPropertyDescriptor(target, 'length')\r\n        );\r\n\r\n        client.nativeMethods.defineProperty(wrapped, __uv.methods.string, {\r\n            enumerable: false,\r\n            value: client.nativeMethods.fnToString.call(target),\r\n        });\r\n\r\n        client.nativeMethods.defineProperty(wrapped, __uv.methods.function, {\r\n            enumerable: false,\r\n            value: target,\r\n        });\r\n    });\r\n\r\n    client.fetch.on('request', (event) => {\r\n        event.data.input = __uv.rewriteUrl(event.data.input);\r\n    });\r\n\r\n    client.fetch.on('requestUrl', (event) => {\r\n        event.data.value = __uv.sourceUrl(event.data.value);\r\n    });\r\n\r\n    client.fetch.on('responseUrl', (event) => {\r\n        event.data.value = __uv.sourceUrl(event.data.value);\r\n    });\r\n\r\n    // XMLHttpRequest\r\n    client.xhr.on('open', (event) => {\r\n        event.data.input = __uv.rewriteUrl(event.data.input);\r\n    });\r\n\r\n    client.xhr.on('responseUrl', (event) => {\r\n        event.data.value = __uv.sourceUrl(event.data.value);\r\n    });\r\n\r\n    // Workers\r\n    client.workers.on('worker', (event) => {\r\n        event.data.url = __uv.rewriteUrl(event.data.url);\r\n    });\r\n\r\n    client.workers.on('addModule', (event) => {\r\n        event.data.url = __uv.rewriteUrl(event.data.url);\r\n    });\r\n\r\n    client.workers.on('importScripts', (event) => {\r\n        for (const i in event.data.scripts) {\r\n            event.data.scripts[i] = __uv.rewriteUrl(event.data.scripts[i]);\r\n        }\r\n    });\r\n\r\n    client.workers.on('postMessage', (event) => {\r\n        let to = event.data.origin;\r\n\r\n        event.data.origin = '*';\r\n        event.data.message = {\r\n            __data: event.data.message,\r\n            __origin: __uv.meta.url.origin,\r\n            __to: to,\r\n        };\r\n    });\r\n\r\n    // Navigator\r\n    client.navigator.on('sendBeacon', (event) => {\r\n        event.data.url = __uv.rewriteUrl(event.data.url);\r\n    });\r\n\r\n    // Cookies\r\n    client.document.on('getCookie', (event) => {\r\n        event.data.value = __uv.cookieStr;\r\n    });\r\n\r\n    client.document.on('setCookie', (event) => {\r\n        Promise.resolve(\r\n            __uv.cookie.setCookies(event.data.value, __uv.db, __uv.meta)\r\n        ).then(() => {\r\n            __uv.cookie.db().then((db) => {\r\n                __uv.cookie.getCookies(db).then((cookies) => {\r\n                    __uv.cookieStr = __uv.cookie.serialize(\r\n                        cookies,\r\n                        __uv.meta,\r\n                        true\r\n                    );\r\n                });\r\n            });\r\n        });\r\n        const cookie = __uv.cookie.setCookie(event.data.value)[0];\r\n\r\n        if (!cookie.path) cookie.path = '/';\r\n        if (!cookie.domain) cookie.domain = __uv.meta.url.hostname;\r\n\r\n        if (__uv.cookie.validateCookie(cookie, __uv.meta, true)) {\r\n            if (__uv.cookieStr.length) __uv.cookieStr += '; ';\r\n            __uv.cookieStr += `${cookie.name}=${cookie.value}`;\r\n        }\r\n\r\n        event.respondWith(event.data.value);\r\n    });\r\n\r\n    // HTML\r\n    client.element.on('setInnerHTML', (event) => {\r\n        switch (event.that.tagName) {\r\n            case 'SCRIPT':\r\n                event.data.value = __uv.js.rewrite(event.data.value);\r\n                break;\r\n            case 'STYLE':\r\n                event.data.value = __uv.rewriteCSS(event.data.value);\r\n                break;\r\n            default:\r\n                event.data.value = __uv.rewriteHtml(event.data.value);\r\n        }\r\n    });\r\n\r\n    client.element.on('getInnerHTML', (event) => {\r\n        switch (event.that.tagName) {\r\n            case 'SCRIPT':\r\n                event.data.value = __uv.js.source(event.data.value);\r\n                break;\r\n            default:\r\n                event.data.value = __uv.sourceHtml(event.data.value);\r\n        }\r\n    });\r\n\r\n    client.element.on('setOuterHTML', (event) => {\r\n        event.data.value = __uv.rewriteHtml(event.data.value, {\r\n            document: event.that.tagName === 'HTML',\r\n        });\r\n    });\r\n\r\n    client.element.on('getOuterHTML', (event) => {\r\n        switch (event.that.tagName) {\r\n            case 'HEAD':\r\n                event.data.value = __uv\r\n                    .sourceHtml(\r\n                        event.data.value.replace(\r\n                            /<head(.*)>(.*)<\\/head>/s,\r\n                            '<op-head$1>$2</op-head>'\r\n                        )\r\n                    )\r\n                    .replace(\r\n                        /<op-head(.*)>(.*)<\\/op-head>/s,\r\n                        '<head$1>$2</head>'\r\n                    );\r\n                break;\r\n            case 'BODY':\r\n                event.data.value = __uv\r\n                    .sourceHtml(\r\n                        event.data.value.replace(\r\n                            /<body(.*)>(.*)<\\/body>/s,\r\n                            '<op-body$1>$2</op-body>'\r\n                        )\r\n                    )\r\n                    .replace(\r\n                        /<op-body(.*)>(.*)<\\/op-body>/s,\r\n                        '<body$1>$2</body>'\r\n                    );\r\n                break;\r\n            default:\r\n                event.data.value = __uv.sourceHtml(event.data.value, {\r\n                    document: event.that.tagName === 'HTML',\r\n                });\r\n                break;\r\n        }\r\n\r\n        //event.data.value = __uv.sourceHtml(event.data.value, { document: event.that.tagName === 'HTML' });\r\n    });\r\n\r\n    client.document.on('write', (event) => {\r\n        if (!event.data.html.length) return false;\r\n        event.data.html = [__uv.rewriteHtml(event.data.html.join(''))];\r\n    });\r\n\r\n    client.document.on('writeln', (event) => {\r\n        if (!event.data.html.length) return false;\r\n        event.data.html = [__uv.rewriteHtml(event.data.html.join(''))];\r\n    });\r\n\r\n    client.element.on('insertAdjacentHTML', (event) => {\r\n        event.data.html = __uv.rewriteHtml(event.data.html);\r\n    });\r\n\r\n    // EventSource\r\n\r\n    client.eventSource.on('construct', (event) => {\r\n        event.data.url = __uv.rewriteUrl(event.data.url);\r\n    });\r\n\r\n    client.eventSource.on('url', (event) => {\r\n        event.data.url = __uv.rewriteUrl(event.data.url);\r\n    });\r\n\r\n    // History\r\n    client.history.on('replaceState', (event) => {\r\n        if (event.data.url)\r\n            event.data.url = __uv.rewriteUrl(\r\n                event.data.url,\r\n                '__uv' in event.that ? event.that.__uv.meta : __uv.meta\r\n            );\r\n    });\r\n    client.history.on('pushState', (event) => {\r\n        if (event.data.url)\r\n            event.data.url = __uv.rewriteUrl(\r\n                event.data.url,\r\n                '__uv' in event.that ? event.that.__uv.meta : __uv.meta\r\n            );\r\n    });\r\n\r\n    // Element get set attribute methods\r\n    client.element.on('getAttribute', (event) => {\r\n        if (\r\n            client.element.hasAttribute.call(\r\n                event.that,\r\n                __uv.attributePrefix + '-attr-' + event.data.name\r\n            )\r\n        ) {\r\n            event.respondWith(\r\n                event.target.call(\r\n                    event.that,\r\n                    __uv.attributePrefix + '-attr-' + event.data.name\r\n                )\r\n            );\r\n        }\r\n    });\r\n\r\n    // Message\r\n    client.message.on('postMessage', (event) => {\r\n        let to = event.data.origin;\r\n        let call = __uv.call;\r\n\r\n        if (event.that) {\r\n            call = event.that.__uv$source.call;\r\n        }\r\n\r\n        event.data.origin = '*';\r\n        event.data.message = {\r\n            __data: event.data.message,\r\n            __origin: (event.that || event.target).__uv$source.location.origin,\r\n            __to: to,\r\n        };\r\n\r\n        event.respondWith(\r\n            worker\r\n                ? call(\r\n                      event.target,\r\n                      [event.data.message, event.data.transfer],\r\n                      event.that\r\n                  )\r\n                : call(\r\n                      event.target,\r\n                      [\r\n                          event.data.message,\r\n                          event.data.origin,\r\n                          event.data.transfer,\r\n                      ],\r\n                      event.that\r\n                  )\r\n        );\r\n    });\r\n\r\n    client.message.on('data', (event) => {\r\n        const { value: data } = event.data;\r\n        if (\r\n            typeof data === 'object' &&\r\n            '__data' in data &&\r\n            '__origin' in data\r\n        ) {\r\n            event.respondWith(data.__data);\r\n        }\r\n    });\r\n\r\n    client.message.on('origin', (event) => {\r\n        const data = client.message.messageData.get.call(event.that);\r\n        if (typeof data === 'object' && data.__data && data.__origin) {\r\n            event.respondWith(data.__origin);\r\n        }\r\n    });\r\n\r\n    client.overrideDescriptor(window, 'origin', {\r\n        get: () => {\r\n            return __uv.location.origin;\r\n        },\r\n    });\r\n\r\n    client.node.on('baseURI', (event) => {\r\n        if (event.data.value.startsWith(window.location.origin))\r\n            event.data.value = __uv.sourceUrl(event.data.value);\r\n    });\r\n\r\n    client.element.on('setAttribute', (event) => {\r\n        if (\r\n            event.that instanceof HTMLMediaElement &&\r\n            event.data.name === 'src' &&\r\n            event.data.value.startsWith('blob:')\r\n        ) {\r\n            event.target.call(\r\n                event.that,\r\n                __uv.attributePrefix + '-attr-' + event.data.name,\r\n                event.data.value\r\n            );\r\n            event.data.value = __uv.blobUrls.get(event.data.value);\r\n            return;\r\n        }\r\n\r\n        if (__uv.attrs.isUrl(event.data.name)) {\r\n            event.target.call(\r\n                event.that,\r\n                __uv.attributePrefix + '-attr-' + event.data.name,\r\n                event.data.value\r\n            );\r\n            event.data.value = __uv.rewriteUrl(event.data.value);\r\n        }\r\n\r\n        if (__uv.attrs.isStyle(event.data.name)) {\r\n            event.target.call(\r\n                event.that,\r\n                __uv.attributePrefix + '-attr-' + event.data.name,\r\n                event.data.value\r\n            );\r\n            event.data.value = __uv.rewriteCSS(event.data.value, {\r\n                context: 'declarationList',\r\n            });\r\n        }\r\n\r\n        if (__uv.attrs.isHtml(event.data.name)) {\r\n            event.target.call(\r\n                event.that,\r\n                __uv.attributePrefix + '-attr-' + event.data.name,\r\n                event.data.value\r\n            );\r\n            event.data.value = __uv.rewriteHtml(event.data.value, {\r\n                ...__uv.meta,\r\n                document: true,\r\n                injectHead: __uv.createHtmlInject(\r\n                    __uv.handlerScript,\r\n                    __uv.bundleScript,\r\n                    __uv.clientScript,\r\n                    __uv.configScript,\r\n                    __uv.bareData,\r\n                    __uv.cookieStr,\r\n                    window.location.href\r\n                ),\r\n            });\r\n        }\r\n\r\n        if (__uv.attrs.isSrcset(event.data.name)) {\r\n            event.target.call(\r\n                event.that,\r\n                __uv.attributePrefix + '-attr-' + event.data.name,\r\n                event.data.value\r\n            );\r\n            event.data.value = __uv.html.wrapSrcset(\r\n                event.data.value.toString()\r\n            );\r\n        }\r\n\r\n        if (__uv.attrs.isForbidden(event.data.name)) {\r\n            event.data.name = __uv.attributePrefix + '-attr-' + event.data.name;\r\n        }\r\n    });\r\n\r\n    client.element.on('audio', (event) => {\r\n        event.data.url = __uv.rewriteUrl(event.data.url);\r\n    });\r\n\r\n    // Element Property Attributes\r\n    client.element.hookProperty(\r\n        [HTMLAnchorElement, HTMLAreaElement, HTMLLinkElement, HTMLBaseElement],\r\n        'href',\r\n        {\r\n            get: (target, that) => {\r\n                return __uv.sourceUrl(target.call(that));\r\n            },\r\n            set: (target, that, [val]) => {\r\n                client.element.setAttribute.call(\r\n                    that,\r\n                    __uv.attributePrefix + '-attr-href',\r\n                    val\r\n                );\r\n                target.call(that, __uv.rewriteUrl(val));\r\n            },\r\n        }\r\n    );\r\n\r\n    client.element.hookProperty(\r\n        [\r\n            HTMLScriptElement,\r\n            HTMLAudioElement,\r\n            HTMLVideoElement,\r\n            HTMLMediaElement,\r\n            HTMLImageElement,\r\n            HTMLInputElement,\r\n            HTMLEmbedElement,\r\n            HTMLIFrameElement,\r\n            HTMLTrackElement,\r\n            HTMLSourceElement,\r\n        ],\r\n        'src',\r\n        {\r\n            get: (target, that) => {\r\n                return __uv.sourceUrl(target.call(that));\r\n            },\r\n            set: (target, that, [val]) => {\r\n                if (\r\n                    new String(val).toString().trim().startsWith('blob:') &&\r\n                    that instanceof HTMLMediaElement\r\n                ) {\r\n                    client.element.setAttribute.call(\r\n                        that,\r\n                        __uv.attributePrefix + '-attr-src',\r\n                        val\r\n                    );\r\n                    return target.call(that, __uv.blobUrls.get(val) || val);\r\n                }\r\n\r\n                client.element.setAttribute.call(\r\n                    that,\r\n                    __uv.attributePrefix + '-attr-src',\r\n                    val\r\n                );\r\n                target.call(that, __uv.rewriteUrl(val));\r\n            },\r\n        }\r\n    );\r\n\r\n    client.element.hookProperty([HTMLFormElement], 'action', {\r\n        get: (target, that) => {\r\n            return __uv.sourceUrl(target.call(that));\r\n        },\r\n        set: (target, that, [val]) => {\r\n            client.element.setAttribute.call(\r\n                that,\r\n                __uv.attributePrefix + '-attr-action',\r\n                val\r\n            );\r\n            target.call(that, __uv.rewriteUrl(val));\r\n        },\r\n    });\r\n\r\n    client.element.hookProperty([HTMLImageElement], 'srcset', {\r\n        get: (target, that) => {\r\n            return (\r\n                client.element.getAttribute.call(\r\n                    that,\r\n                    __uv.attributePrefix + '-attr-srcset'\r\n                ) || target.call(that)\r\n            );\r\n        },\r\n        set: (target, that, [val]) => {\r\n            client.element.setAttribute.call(\r\n                that,\r\n                __uv.attributePrefix + '-attr-srcset',\r\n                val\r\n            );\r\n            target.call(that, __uv.html.wrapSrcset(val.toString()));\r\n        },\r\n    });\r\n\r\n    client.element.hookProperty(HTMLScriptElement, 'integrity', {\r\n        get: (target, that) => {\r\n            return client.element.getAttribute.call(\r\n                that,\r\n                __uv.attributePrefix + '-attr-integrity'\r\n            );\r\n        },\r\n        set: (target, that, [val]) => {\r\n            client.element.setAttribute.call(\r\n                that,\r\n                __uv.attributePrefix + '-attr-integrity',\r\n                val\r\n            );\r\n        },\r\n    });\r\n\r\n    client.element.hookProperty(HTMLIFrameElement, 'sandbox', {\r\n        get: (target, that) => {\r\n            return (\r\n                client.element.getAttribute.call(\r\n                    that,\r\n                    __uv.attributePrefix + '-attr-sandbox'\r\n                ) || target.call(that)\r\n            );\r\n        },\r\n        set: (target, that, [val]) => {\r\n            client.element.setAttribute.call(\r\n                that,\r\n                __uv.attributePrefix + '-attr-sandbox',\r\n                val\r\n            );\r\n        },\r\n    });\r\n\r\n    // HTMLIFrameElement may not be defined (workers)\r\n    const contentWindowGet =\r\n        HTMLIFrameElement &&\r\n        Object.getOwnPropertyDescriptor(\r\n            HTMLIFrameElement.prototype,\r\n            'contentWindow'\r\n        ).get;\r\n\r\n    function uvInject(that) {\r\n        const win = contentWindowGet.call(that);\r\n\r\n        if (!win.__uv)\r\n            try {\r\n                win.__uv$bareData = __uv.bareData;\r\n                win.__uv$cookies = __uv.cookieStr;\r\n                __uvHook(win, config, bare);\r\n            } catch (e) {\r\n                console.error('catastrophic failure');\r\n                console.error(e);\r\n            }\r\n    }\r\n\r\n    client.element.hookProperty(HTMLIFrameElement, 'contentWindow', {\r\n        get: (target, that) => {\r\n            uvInject(that);\r\n            return target.call(that);\r\n        },\r\n    });\r\n\r\n    client.element.hookProperty(HTMLIFrameElement, 'contentDocument', {\r\n        get: (target, that) => {\r\n            uvInject(that);\r\n            return target.call(that);\r\n        },\r\n    });\r\n\r\n    client.element.hookProperty(HTMLIFrameElement, 'srcdoc', {\r\n        get: (target, that) => {\r\n            return (\r\n                client.element.getAttribute.call(\r\n                    that,\r\n                    __uv.attributePrefix + '-attr-srcdoc'\r\n                ) || target.call(that)\r\n            );\r\n        },\r\n        set: (target, that, [val]) => {\r\n            target.call(\r\n                that,\r\n                __uv.rewriteHtml(val, {\r\n                    document: true,\r\n                    injectHead: __uv.createHtmlInject(\r\n                        __uv.handlerScript,\r\n                        __uv.bundleScript,\r\n                        __uv.clientScript,\r\n                        __uv.configScript,\r\n                        __uv.bareData,\r\n                        __uv.cookieStr,\r\n                        window.location.href\r\n                    ),\r\n                })\r\n            );\r\n        },\r\n    });\r\n\r\n    client.node.on('getTextContent', (event) => {\r\n        if (event.that.tagName === 'SCRIPT') {\r\n            event.data.value = __uv.js.source(event.data.value);\r\n        }\r\n    });\r\n\r\n    client.node.on('setTextContent', (event) => {\r\n        if (event.that.tagName === 'SCRIPT') {\r\n            event.data.value = __uv.js.rewrite(event.data.value);\r\n        }\r\n    });\r\n\r\n    // Until proper rewriting is implemented for service workers.\r\n    // Not sure atm how to implement it with the already built in service worker\r\n    if ('serviceWorker' in window.navigator) {\r\n        delete window.Navigator.prototype.serviceWorker;\r\n    }\r\n\r\n    // Document\r\n    client.document.on('getDomain', (event) => {\r\n        event.data.value = __uv.domain;\r\n    });\r\n    client.document.on('setDomain', (event) => {\r\n        if (\r\n            !event.data.value\r\n                .toString()\r\n                .endsWith(__uv.meta.url.hostname.split('.').slice(-2).join('.'))\r\n        )\r\n            return event.respondWith('');\r\n        event.respondWith((__uv.domain = event.data.value));\r\n    });\r\n\r\n    client.document.on('url', (event) => {\r\n        event.data.value = __uv.location.href;\r\n    });\r\n\r\n    client.document.on('documentURI', (event) => {\r\n        event.data.value = __uv.location.href;\r\n    });\r\n\r\n    client.document.on('referrer', (event) => {\r\n        event.data.value = __uv.referrer || __uv.sourceUrl(event.data.value);\r\n    });\r\n\r\n    client.document.on('parseFromString', (event) => {\r\n        if (event.data.type !== 'text/html') return false;\r\n        event.data.string = __uv.rewriteHtml(event.data.string, {\r\n            ...__uv.meta,\r\n            document: true,\r\n        });\r\n    });\r\n\r\n    // Attribute (node.attributes)\r\n    client.attribute.on('getValue', (event) => {\r\n        if (\r\n            client.element.hasAttribute.call(\r\n                event.that.ownerElement,\r\n                __uv.attributePrefix + '-attr-' + event.data.name\r\n            )\r\n        ) {\r\n            event.data.value = client.element.getAttribute.call(\r\n                event.that.ownerElement,\r\n                __uv.attributePrefix + '-attr-' + event.data.name\r\n            );\r\n        }\r\n    });\r\n\r\n    client.attribute.on('setValue', (event) => {\r\n        if (__uv.attrs.isUrl(event.data.name)) {\r\n            client.element.setAttribute.call(\r\n                event.that.ownerElement,\r\n                __uv.attributePrefix + '-attr-' + event.data.name,\r\n                event.data.value\r\n            );\r\n            event.data.value = __uv.rewriteUrl(event.data.value);\r\n        }\r\n\r\n        if (__uv.attrs.isStyle(event.data.name)) {\r\n            client.element.setAttribute.call(\r\n                event.that.ownerElement,\r\n                __uv.attributePrefix + '-attr-' + event.data.name,\r\n                event.data.value\r\n            );\r\n            event.data.value = __uv.rewriteCSS(event.data.value, {\r\n                context: 'declarationList',\r\n            });\r\n        }\r\n\r\n        if (__uv.attrs.isHtml(event.data.name)) {\r\n            client.element.setAttribute.call(\r\n                event.that.ownerElement,\r\n                __uv.attributePrefix + '-attr-' + event.data.name,\r\n                event.data.value\r\n            );\r\n            event.data.value = __uv.rewriteHtml(event.data.value, {\r\n                ...__uv.meta,\r\n                document: true,\r\n                injectHead: __uv.createHtmlInject(\r\n                    __uv.handlerScript,\r\n                    __uv.bundleScript,\r\n                    __uv.clientScript,\r\n                    __uv.configScript,\r\n                    __uv.bareData,\r\n                    __uv.cookieStr,\r\n                    window.location.href\r\n                ),\r\n            });\r\n        }\r\n\r\n        if (__uv.attrs.isSrcset(event.data.name)) {\r\n            client.element.setAttribute.call(\r\n                event.that.ownerElement,\r\n                __uv.attributePrefix + '-attr-' + event.data.name,\r\n                event.data.value\r\n            );\r\n            event.data.value = __uv.html.wrapSrcset(\r\n                event.data.value.toString()\r\n            );\r\n        }\r\n    });\r\n\r\n    // URL\r\n    client.url.on('createObjectURL', (event) => {\r\n        let url = event.target.call(event.that, event.data.object);\r\n        if (url.startsWith('blob:' + location.origin)) {\r\n            let newUrl =\r\n                'blob:' +\r\n                (__uv.meta.url.href !== 'about:blank'\r\n                    ? __uv.meta.url.origin\r\n                    : window.parent.__uv.meta.url.origin) +\r\n                url.slice('blob:'.length + location.origin.length);\r\n            __uv.blobUrls.set(newUrl, url);\r\n            event.respondWith(newUrl);\r\n        } else {\r\n            event.respondWith(url);\r\n        }\r\n    });\r\n\r\n    client.url.on('revokeObjectURL', (event) => {\r\n        if (__uv.blobUrls.has(event.data.url)) {\r\n            const old = event.data.url;\r\n            event.data.url = __uv.blobUrls.get(event.data.url);\r\n            __uv.blobUrls.delete(old);\r\n        }\r\n    });\r\n\r\n    client.storage.on('get', (event) => {\r\n        event.data.name =\r\n            methodPrefix + __uv.meta.url.origin + '@' + event.data.name;\r\n    });\r\n\r\n    client.storage.on('set', (event) => {\r\n        if (event.that.__uv$storageObj) {\r\n            event.that.__uv$storageObj[event.data.name] = event.data.value;\r\n        }\r\n        event.data.name =\r\n            methodPrefix + __uv.meta.url.origin + '@' + event.data.name;\r\n    });\r\n\r\n    client.storage.on('delete', (event) => {\r\n        if (event.that.__uv$storageObj) {\r\n            delete event.that.__uv$storageObj[event.data.name];\r\n        }\r\n        event.data.name =\r\n            methodPrefix + __uv.meta.url.origin + '@' + event.data.name;\r\n    });\r\n\r\n    client.storage.on('getItem', (event) => {\r\n        event.data.name =\r\n            methodPrefix + __uv.meta.url.origin + '@' + event.data.name;\r\n    });\r\n\r\n    client.storage.on('setItem', (event) => {\r\n        if (event.that.__uv$storageObj) {\r\n            event.that.__uv$storageObj[event.data.name] = event.data.value;\r\n        }\r\n        event.data.name =\r\n            methodPrefix + __uv.meta.url.origin + '@' + event.data.name;\r\n    });\r\n\r\n    client.storage.on('removeItem', (event) => {\r\n        if (event.that.__uv$storageObj) {\r\n            delete event.that.__uv$storageObj[event.data.name];\r\n        }\r\n        event.data.name =\r\n            methodPrefix + __uv.meta.url.origin + '@' + event.data.name;\r\n    });\r\n\r\n    client.storage.on('clear', (event) => {\r\n        if (event.that.__uv$storageObj) {\r\n            for (const key of client.nativeMethods.keys.call(\r\n                null,\r\n                event.that.__uv$storageObj\r\n            )) {\r\n                delete event.that.__uv$storageObj[key];\r\n                client.storage.removeItem.call(\r\n                    event.that,\r\n                    methodPrefix + __uv.meta.url.origin + '@' + key\r\n                );\r\n                event.respondWith();\r\n            }\r\n        }\r\n    });\r\n\r\n    client.storage.on('length', (event) => {\r\n        if (event.that.__uv$storageObj) {\r\n            event.respondWith(\r\n                client.nativeMethods.keys.call(null, event.that.__uv$storageObj)\r\n                    .length\r\n            );\r\n        }\r\n    });\r\n\r\n    client.storage.on('key', (event) => {\r\n        if (event.that.__uv$storageObj) {\r\n            event.respondWith(\r\n                client.nativeMethods.keys.call(\r\n                    null,\r\n                    event.that.__uv$storageObj\r\n                )[event.data.index] || null\r\n            );\r\n        }\r\n    });\r\n\r\n    function eventTarget(target, event) {\r\n        const property = `on${event}`;\r\n        const listeners = new WeakMap();\r\n\r\n        Reflect.defineProperty(target, property, {\r\n            enumerable: true,\r\n            configurable: true,\r\n            get() {\r\n                if (listeners.has(this)) {\r\n                    return listeners.get(this);\r\n                } else {\r\n                    return null;\r\n                }\r\n            },\r\n            set(value) {\r\n                if (typeof value == 'function') {\r\n                    if (listeners.has(this)) {\r\n                        this.removeEventListener(event, listeners.get(this));\r\n                    }\r\n\r\n                    listeners.set(this, value);\r\n                    this.addEventListener(event, value);\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    const wsProtocols = ['ws:', 'wss:'];\r\n\r\n    class MockWebSocket extends EventTarget {\r\n        /**\r\n         * @type {import(\"@tomphttp/bare-client\").BareWebSocket}\r\n         */\r\n        #socket;\r\n        #ready;\r\n        #binaryType = 'blob';\r\n        #protocol = '';\r\n        #extensions = '';\r\n        #url = '';\r\n        /**\r\n         *\r\n         * @param {URL} remote\r\n         * @param {any} protocol\r\n         */\r\n        async #open(url, protocol) {\r\n            const requestHeaders = {};\r\n            Reflect.setPrototypeOf(requestHeaders, null);\r\n\r\n            requestHeaders['Origin'] = __uv.meta.url.origin;\r\n            requestHeaders['User-Agent'] = navigator.userAgent;\r\n\r\n            if (__uv.cookieStr !== '')\r\n                requestHeaders['Cookie'] = __uv.cookieStr.toString();\r\n\r\n            this.#socket = await bareClient.createWebSocket(\r\n                url,\r\n                requestHeaders,\r\n                protocol\r\n            );\r\n\r\n            this.#socket.binaryType = this.#binaryType;\r\n\r\n            this.#socket.addEventListener('message', (event) => {\r\n                this.dispatchEvent(new MessageEvent('message', event));\r\n            });\r\n\r\n            this.#socket.addEventListener('open', async (event) => {\r\n                this.dispatchEvent(new Event('open', event));\r\n            });\r\n\r\n            this.#socket.addEventListener('error', (event) => {\r\n                this.dispatchEvent(new ErrorEvent('error', event));\r\n            });\r\n\r\n            this.#socket.addEventListener('close', (event) => {\r\n                this.dispatchEvent(new Event('close', event));\r\n            });\r\n\r\n            const meta = await this.#socket.meta;\r\n\r\n            if (meta.headers.has('sec-websocket-protocol'))\r\n                this.#protocol = meta.headers.get('sec-websocket-protocol');\r\n\r\n            if (meta.headers.has('sec-websocket-extensions'))\r\n                this.#extensions = meta.headers.get('sec-websocket-extensions');\r\n\r\n            let setCookie = meta.rawHeaders['set-cookie'] || [];\r\n            if (!Array.isArray(setCookie)) setCookie = [];\r\n            // trip the hook\r\n            for (const cookie of setCookie) document.cookie = cookie;\r\n        }\r\n        get url() {\r\n            return this.#url;\r\n        }\r\n        constructor(...args) {\r\n            super();\r\n\r\n            if (!args.length)\r\n                throw new DOMException(\r\n                    `Failed to construct 'WebSocket': 1 argument required, but only 0 present.`\r\n                );\r\n\r\n            const [url, protocol] = args;\r\n\r\n            let parsed;\r\n\r\n            try {\r\n                parsed = new URL(url);\r\n            } catch (err) {\r\n                throw new DOMException(\r\n                    `Faiiled to construct 'WebSocket': The URL '${url}' is invalid.`\r\n                );\r\n            }\r\n\r\n            if (!wsProtocols.includes(parsed.protocol)) {\r\n                throw new DOMException(\r\n                    `Failed to construct 'WebSocket': The URL's scheme must be either 'ws' or 'wss'. '${parsed.protocol}' is not allowed.`\r\n                );\r\n            }\r\n\r\n            this.#ready = this.#open(parsed, protocol);\r\n        }\r\n        get protocol() {\r\n            return this.#protocol;\r\n        }\r\n        get extensions() {\r\n            return this.#extensions;\r\n        }\r\n        get readyState() {\r\n            if (this.#socket) {\r\n                return this.#socket.readyState;\r\n            } else {\r\n                return MockWebSocket.CONNECTING;\r\n            }\r\n        }\r\n        get binaryType() {\r\n            return this.#binaryType;\r\n        }\r\n        set binaryType(value) {\r\n            this.#binaryType = value;\r\n\r\n            if (this.#socket) {\r\n                this.#socket.binaryType = value;\r\n            }\r\n        }\r\n        send(data) {\r\n            if (!this.#socket) {\r\n                throw new DOMException(\r\n                    `Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.`\r\n                );\r\n            }\r\n            this.#socket.send(data);\r\n        }\r\n        close(code, reason) {\r\n            if (typeof code !== 'undefined') {\r\n                if (typeof code !== 'number') {\r\n                    code = 0;\r\n                }\r\n\r\n                if (code !== 1000 && (code < 3000 || code > 4999)) {\r\n                    throw new DOMException(\r\n                        `Failed to execute 'close' on 'WebSocket': The code must be either 1000, or between 3000 and 4999. ${code} is neither.`\r\n                    );\r\n                }\r\n            }\r\n\r\n            this.#ready.then(() => this.#socket.close(code, reason));\r\n        }\r\n    }\r\n\r\n    eventTarget(MockWebSocket.prototype, 'close');\r\n    eventTarget(MockWebSocket.prototype, 'open');\r\n    eventTarget(MockWebSocket.prototype, 'message');\r\n    eventTarget(MockWebSocket.prototype, 'error');\r\n\r\n    for (const hook of [\r\n        'url',\r\n        'protocol',\r\n        'extensions',\r\n        'readyState',\r\n        'binaryType',\r\n    ]) {\r\n        const officialDesc = Object.getOwnPropertyDescriptor(\r\n            window.WebSocket.prototype,\r\n            hook\r\n        );\r\n        const customDesc = Object.getOwnPropertyDescriptor(\r\n            MockWebSocket.prototype,\r\n            hook\r\n        );\r\n\r\n        if (customDesc?.get && officialDesc?.get)\r\n            client.emit('wrap', customDesc.get, officialDesc.get);\r\n\r\n        if (customDesc?.set && officialDesc?.set)\r\n            client.emit('wrap', customDesc.get, officialDesc.get);\r\n    }\r\n\r\n    client.emit(\r\n        'wrap',\r\n        window.WebSocket.prototype.send,\r\n        MockWebSocket.prototype.send\r\n    );\r\n    client.emit(\r\n        'wrap',\r\n        window.WebSocket.prototype.close,\r\n        MockWebSocket.prototype.close\r\n    );\r\n\r\n    client.override(\r\n        window,\r\n        'WebSocket',\r\n        (target, that, args) => new MockWebSocket(...args),\r\n        true\r\n    );\r\n\r\n    MockWebSocket.prototype.constructor = window.WebSocket;\r\n\r\n    client.function.on('function', (event) => {\r\n        event.data.script = __uv.rewriteJS(event.data.script);\r\n    });\r\n\r\n    client.function.on('toString', (event) => {\r\n        if (__uv.methods.string in event.that)\r\n            event.respondWith(event.that[__uv.methods.string]);\r\n    });\r\n\r\n    client.object.on('getOwnPropertyNames', (event) => {\r\n        event.data.names = event.data.names.filter(\r\n            (element) => !__uv.filterKeys.includes(element)\r\n        );\r\n    });\r\n\r\n    client.object.on('getOwnPropertyDescriptors', (event) => {\r\n        for (const forbidden of __uv.filterKeys) {\r\n            delete event.data.descriptors[forbidden];\r\n        }\r\n    });\r\n\r\n    client.style.on('setProperty', (event) => {\r\n        if (client.style.dashedUrlProps.includes(event.data.property)) {\r\n            event.data.value = __uv.rewriteCSS(event.data.value, {\r\n                context: 'value',\r\n                ...__uv.meta,\r\n            });\r\n        }\r\n    });\r\n\r\n    client.style.on('getPropertyValue', (event) => {\r\n        if (client.style.dashedUrlProps.includes(event.data.property)) {\r\n            event.respondWith(\r\n                __uv.sourceCSS(\r\n                    event.target.call(event.that, event.data.property),\r\n                    {\r\n                        context: 'value',\r\n                        ...__uv.meta,\r\n                    }\r\n                )\r\n            );\r\n        }\r\n    });\r\n\r\n    if ('CSS2Properties' in window) {\r\n        for (const key of client.style.urlProps) {\r\n            client.overrideDescriptor(window.CSS2Properties.prototype, key, {\r\n                get: (target, that) => {\r\n                    return __uv.sourceCSS(target.call(that), {\r\n                        context: 'value',\r\n                        ...__uv.meta,\r\n                    });\r\n                },\r\n                set: (target, that, val) => {\r\n                    target.call(\r\n                        that,\r\n                        __uv.rewriteCSS(val, {\r\n                            context: 'value',\r\n                            ...__uv.meta,\r\n                        })\r\n                    );\r\n                },\r\n            });\r\n        }\r\n    } else if ('HTMLElement' in window) {\r\n        client.overrideDescriptor(window.HTMLElement.prototype, 'style', {\r\n            get: (target, that) => {\r\n                const value = target.call(that);\r\n                if (!value[methodPrefix + 'modifiedStyle']) {\r\n                    for (const key of client.style.urlProps) {\r\n                        client.nativeMethods.defineProperty(value, key, {\r\n                            enumerable: true,\r\n                            configurable: true,\r\n                            get() {\r\n                                const value =\r\n                                    client.style.getPropertyValue.call(\r\n                                        this,\r\n                                        key\r\n                                    ) || '';\r\n                                return __uv.sourceCSS(value, {\r\n                                    context: 'value',\r\n                                    ...__uv.meta,\r\n                                });\r\n                            },\r\n                            set(val) {\r\n                                client.style.setProperty.call(\r\n                                    this,\r\n                                    client.style.propToDashed[key] || key,\r\n                                    __uv.rewriteCSS(val, {\r\n                                        context: 'value',\r\n                                        ...__uv.meta,\r\n                                    })\r\n                                );\r\n                            },\r\n                        });\r\n                        client.nativeMethods.defineProperty(\r\n                            value,\r\n                            methodPrefix + 'modifiedStyle',\r\n                            {\r\n                                enumerable: false,\r\n                                value: true,\r\n                            }\r\n                        );\r\n                    }\r\n                }\r\n                return value;\r\n            },\r\n        });\r\n    }\r\n\r\n    client.style.on('setCssText', (event) => {\r\n        event.data.value = __uv.rewriteCSS(event.data.value, {\r\n            context: 'declarationList',\r\n            ...__uv.meta,\r\n        });\r\n    });\r\n\r\n    client.style.on('getCssText', (event) => {\r\n        event.data.value = __uv.sourceCSS(event.data.value, {\r\n            context: 'declarationList',\r\n            ...__uv.meta,\r\n        });\r\n    });\r\n\r\n    // Proper hash emulation.\r\n    __uv.addEventListener.call(window, 'hashchange', (event) => {\r\n        if (event.__uv$dispatched) return false;\r\n        event.stopImmediatePropagation();\r\n        const hash = window.location.hash;\r\n        client.history.replaceState.call(window.history, '', '', event.oldURL);\r\n        __uv.location.hash = hash;\r\n    });\r\n\r\n    client.location.on('hashchange', (oldUrl, newUrl, ctx) => {\r\n        if (ctx.HashChangeEvent && client.history.replaceState) {\r\n            client.history.replaceState.call(\r\n                window.history,\r\n                '',\r\n                '',\r\n                __uv.rewriteUrl(newUrl)\r\n            );\r\n\r\n            const event = new ctx.HashChangeEvent('hashchange', {\r\n                newURL: newUrl,\r\n                oldURL: oldUrl,\r\n            });\r\n\r\n            client.nativeMethods.defineProperty(\r\n                event,\r\n                methodPrefix + 'dispatched',\r\n                {\r\n                    value: true,\r\n                    enumerable: false,\r\n                }\r\n            );\r\n\r\n            __uv.dispatchEvent.call(window, event);\r\n        }\r\n    });\r\n\r\n    // Hooking functions & descriptors\r\n    client.fetch.overrideRequest();\r\n    client.fetch.overrideUrl();\r\n    client.xhr.overrideOpen();\r\n    client.xhr.overrideResponseUrl();\r\n    client.element.overrideHtml();\r\n    client.element.overrideAttribute();\r\n    client.element.overrideInsertAdjacentHTML();\r\n    client.element.overrideAudio();\r\n    // client.element.overrideQuerySelector();\r\n    client.node.overrideBaseURI();\r\n    client.node.overrideTextContent();\r\n    client.attribute.overrideNameValue();\r\n    client.document.overrideDomain();\r\n    client.document.overrideURL();\r\n    client.document.overrideDocumentURI();\r\n    client.document.overrideWrite();\r\n    client.document.overrideReferrer();\r\n    client.document.overrideParseFromString();\r\n    client.storage.overrideMethods();\r\n    client.storage.overrideLength();\r\n    //client.document.overrideQuerySelector();\r\n    client.object.overrideGetPropertyNames();\r\n    client.object.overrideGetOwnPropertyDescriptors();\r\n    client.history.overridePushState();\r\n    client.history.overrideReplaceState();\r\n    client.eventSource.overrideConstruct();\r\n    client.eventSource.overrideUrl();\r\n    client.url.overrideObjectURL();\r\n    client.document.overrideCookie();\r\n    client.message.overridePostMessage();\r\n    client.message.overrideMessageOrigin();\r\n    client.message.overrideMessageData();\r\n    client.workers.overrideWorker();\r\n    client.workers.overrideAddModule();\r\n    client.workers.overrideImportScripts();\r\n    client.workers.overridePostMessage();\r\n    client.style.overrideSetGetProperty();\r\n    client.style.overrideCssText();\r\n    client.navigator.overrideSendBeacon();\r\n    client.function.overrideFunction();\r\n    client.function.overrideToString();\r\n    client.location.overrideWorkerLocation((href) => {\r\n        return new URL(__uv.sourceUrl(href));\r\n    });\r\n\r\n    client.overrideDescriptor(window, 'localStorage', {\r\n        get: (target, that) => {\r\n            return (that || window).__uv.lsWrap;\r\n        },\r\n    });\r\n    client.overrideDescriptor(window, 'sessionStorage', {\r\n        get: (target, that) => {\r\n            return (that || window).__uv.ssWrap;\r\n        },\r\n    });\r\n\r\n    client.override(window, 'open', (target, that, args) => {\r\n        if (!args.length) return target.apply(that, args);\r\n        let [url] = args;\r\n\r\n        url = __uv.rewriteUrl(url);\r\n\r\n        return target.call(that, url);\r\n    });\r\n\r\n    __uv.$wrap = function (name) {\r\n        if (name === 'location') return __uv.methods.location;\r\n        if (name === 'eval') return __uv.methods.eval;\r\n        return name;\r\n    };\r\n\r\n    __uv.$get = function (that) {\r\n        if (that === window.location) return __uv.location;\r\n        if (that === window.eval) return __uv.eval;\r\n        if (that === window.parent) {\r\n            return window.__uv$parent;\r\n        }\r\n        if (that === window.top) {\r\n            return window.__uv$top;\r\n        }\r\n        return that;\r\n    };\r\n\r\n    __uv.eval = client.wrap(window, 'eval', (target, that, args) => {\r\n        if (!args.length || typeof args[0] !== 'string')\r\n            return target.apply(that, args);\r\n        let [script] = args;\r\n\r\n        script = __uv.rewriteJS(script);\r\n        return target.call(that, script);\r\n    });\r\n\r\n    __uv.call = function (target, args, that) {\r\n        return that ? target.apply(that, args) : target(...args);\r\n    };\r\n\r\n    __uv.call$ = function (obj, prop, args = []) {\r\n        return obj[prop].apply(obj, args);\r\n    };\r\n\r\n    client.nativeMethods.defineProperty(window.Object.prototype, master, {\r\n        get: () => {\r\n            return __uv;\r\n        },\r\n        enumerable: false,\r\n    });\r\n\r\n    client.nativeMethods.defineProperty(\r\n        window.Object.prototype,\r\n        __uv.methods.setSource,\r\n        {\r\n            value: function (source) {\r\n                if (!client.nativeMethods.isExtensible(this)) return this;\r\n\r\n                client.nativeMethods.defineProperty(this, __uv.methods.source, {\r\n                    value: source,\r\n                    writable: true,\r\n                    enumerable: false,\r\n                });\r\n\r\n                return this;\r\n            },\r\n            enumerable: false,\r\n        }\r\n    );\r\n\r\n    client.nativeMethods.defineProperty(\r\n        window.Object.prototype,\r\n        __uv.methods.source,\r\n        {\r\n            value: __uv,\r\n            writable: true,\r\n            enumerable: false,\r\n        }\r\n    );\r\n\r\n    client.nativeMethods.defineProperty(\r\n        window.Object.prototype,\r\n        __uv.methods.location,\r\n        {\r\n            configurable: true,\r\n            get() {\r\n                return this === window.document || this === window\r\n                    ? __uv.location\r\n                    : this.location;\r\n            },\r\n            set(val) {\r\n                if (this === window.document || this === window) {\r\n                    __uv.location.href = val;\r\n                } else {\r\n                    this.location = val;\r\n                }\r\n            },\r\n        }\r\n    );\r\n\r\n    client.nativeMethods.defineProperty(\r\n        window.Object.prototype,\r\n        __uv.methods.parent,\r\n        {\r\n            configurable: true,\r\n            get() {\r\n                const val = this.parent;\r\n\r\n                if (this === window) {\r\n                    try {\r\n                        return '__uv' in val ? val : this;\r\n                    } catch (e) {\r\n                        return this;\r\n                    }\r\n                }\r\n                return val;\r\n            },\r\n            set(val) {\r\n                this.parent = val;\r\n            },\r\n        }\r\n    );\r\n\r\n    client.nativeMethods.defineProperty(\r\n        window.Object.prototype,\r\n        __uv.methods.top,\r\n        {\r\n            configurable: true,\r\n            get() {\r\n                const val = this.top;\r\n\r\n                if (this === window) {\r\n                    if (val === this.parent) return this[__uv.methods.parent];\r\n                    try {\r\n                        if (!('__uv' in val)) {\r\n                            let current = this;\r\n\r\n                            while (current.parent !== val) {\r\n                                current = current.parent;\r\n                            }\r\n\r\n                            return '__uv' in current ? current : this;\r\n                        } else {\r\n                            return val;\r\n                        }\r\n                    } catch (e) {\r\n                        return this;\r\n                    }\r\n                }\r\n                return val;\r\n            },\r\n            set(val) {\r\n                this.top = val;\r\n            },\r\n        }\r\n    );\r\n\r\n    client.nativeMethods.defineProperty(\r\n        window.Object.prototype,\r\n        __uv.methods.eval,\r\n        {\r\n            configurable: true,\r\n            get() {\r\n                return this === window ? __uv.eval : this.eval;\r\n            },\r\n            set(val) {\r\n                this.eval = val;\r\n            },\r\n        }\r\n    );\r\n}\r\n\r\nself.__uvHook = __uvHook;\r\n"],"names":["Ultraviolet","globalThis","UVClient","__uvHook","window","config","bare","__uv","document","querySelectorAll","forEach","node","remove","worker","master","methodPrefix","construct","client","HTMLMediaElement","HTMLScriptElement","HTMLAudioElement","HTMLVideoElement","HTMLInputElement","HTMLEmbedElement","HTMLTrackElement","HTMLAnchorElement","HTMLIFrameElement","HTMLAreaElement","HTMLLinkElement","HTMLBaseElement","HTMLFormElement","HTMLImageElement","HTMLSourceElement","nativeMethods","defineProperty","value","enumerable","meta","origin","location","emulate","href","URL","startsWith","slice","length","sourceUrl","rewriteUrl","bareData","__uv$bareData","cookieStr","__uv$cookies","url","domain","host","blobUrls","Map","referrer","cookies","localStorageObj","sessionStorageObj","e","parent","bareClient","BareClient","EventTarget","addEventListener","prototype","removeListener","dispatchEvent","storage","storeProto","get","this","sessionStorage","localStorage","key","getItem","lsWrap","ssWrap","rawBase","baseURI","call","base","methods","setSource","source","function","string","eval","top","filterKeys","on","target","wrapped","getOwnPropertyDescriptor","fnToString","fetch","event","data","input","xhr","workers","i","scripts","to","message","__data","__origin","__to","navigator","Promise","resolve","cookie","setCookies","db","then","getCookies","serialize","setCookie","path","hostname","validateCookie","name","respondWith","element","that","tagName","js","rewrite","rewriteCSS","rewriteHtml","sourceHtml","replace","html","join","eventSource","history","hasAttribute","attributePrefix","__uv$source","transfer","messageData","overrideDescriptor","attrs","isUrl","isStyle","context","isHtml","injectHead","createHtmlInject","handlerScript","bundleScript","clientScript","configScript","isSrcset","wrapSrcset","toString","isForbidden","hookProperty","set","val","setAttribute","String","trim","getAttribute","contentWindowGet","Object","uvInject","win","console","error","eventTarget","property","listeners","WeakMap","Reflect","configurable","has","removeEventListener","Navigator","serviceWorker","endsWith","split","type","attribute","ownerElement","object","newUrl","old","delete","__uv$storageObj","keys","removeItem","index","wsProtocols","MockWebSocket","async","protocol","requestHeaders","setPrototypeOf","userAgent","createWebSocket","binaryType","MessageEvent","Event","ErrorEvent","headers","rawHeaders","Array","isArray","constructor","args","super","DOMException","parsed","err","includes","extensions","readyState","CONNECTING","send","close","code","reason","hook","officialDesc","WebSocket","customDesc","emit","override","script","rewriteJS","names","filter","forbidden","descriptors","style","dashedUrlProps","sourceCSS","urlProps","CSS2Properties","HTMLElement","getPropertyValue","setProperty","propToDashed","__uv$dispatched","stopImmediatePropagation","hash","replaceState","oldURL","oldUrl","ctx","HashChangeEvent","newURL","overrideRequest","overrideUrl","overrideOpen","overrideResponseUrl","overrideHtml","overrideAttribute","overrideInsertAdjacentHTML","overrideAudio","overrideBaseURI","overrideTextContent","overrideNameValue","overrideDomain","overrideURL","overrideDocumentURI","overrideWrite","overrideReferrer","overrideParseFromString","overrideMethods","overrideLength","overrideGetPropertyNames","overrideGetOwnPropertyDescriptors","overridePushState","overrideReplaceState","overrideConstruct","overrideObjectURL","overrideCookie","overridePostMessage","overrideMessageOrigin","overrideMessageData","overrideWorker","overrideAddModule","overrideImportScripts","overrideSetGetProperty","overrideCssText","overrideSendBeacon","overrideFunction","overrideToString","overrideWorkerLocation","apply","$wrap","$get","__uv$parent","__uv$top","wrap","call$","obj","prop","isExtensible","writable","current","self","__uv$config"],"sourceRoot":""}